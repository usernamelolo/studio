<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GROK ADULT STUDIO 2.0 • Профессиональный генератор контента для взрослых</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #f8fafc; font-family: system-ui; }
    .header { background: linear-gradient(90deg, #4f46e5, #7c3aed); }
    .tab-active { background: #4f46e5; color: white; font-weight: 700; }
    .card { background: white; border: 2px solid #e0e7ff; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.05); }
    video, img { border-radius: 16px; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1); }
    #debug { background: #f1f5f9; border: 2px solid #64748b; font-family: monospace; white-space: pre-wrap; font-size: 13px; }
      <!-- БЛОК ОТЛАДКИ -->
      <div class="mt-12">
        <h3 class="text-xl font-medium mb-3 text-slate-700">Отладка (что вернул API)</h3>
        <div id="debug" class="bg-slate-900 text-emerald-300 p-6 rounded-2xl font-mono text-sm overflow-auto max-h-96 border border-slate-700"></div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = "/api/proxy";

    let currentTab = 0;
    function switchTab(n) {
      currentTab = n;
      document.getElementById('section-video').classList.toggle('hidden', n !== 0);
      document.getElementById('section-image').classList.toggle('hidden', n !== 1);
      document.getElementById('tab0').classList.toggle('tab-active', n === 0);
      document.getElementById('tab1').classList.toggle('tab-active', n === 1);
    }

    let currentVideoUrl = '';

    async function apiFetch(endpoint, options = {}) {
      return fetch(API_BASE + endpoint, {
        ...options,
        headers: { ...options.headers, 'Content-Type': 'application/json' }
      });
    }

        if (!res.ok) throw new Error(data.error?.message || 'Ошибка сервера');
        const url = img.url || '';
        const div = document.createElement('div');
        div.className = 'relative group';
        div.innerHTML = `
          <img src="\( {url}" class="w-full cursor-pointer" onclick="window.open(' \){url}', '_blank')" onerror="this.src='https://via.placeholder.com/400x500/64748b/ffffff?text=Нет+изображения'">
          <button onclick="downloadImage('${url}')" class="absolute bottom-4 right-4 bg-white/90 px-6 py-2 rounded-2xl text-sm hover:bg-indigo-600 hover:text-white transition">Скачать</button>
        `;
        gallery.appendChild(div);
      });
    }

    function downloadImage(url) {
      if (!url) return alert('Нет ссылки на изображение');
      const a = document.createElement('a');
      a.href = url;
      a.download = `adult-image-${Date.now()}.jpg`;
      a.click();
    }

    async function generateImages() {
      const prompt = document.getElementById('image-prompt').value.trim();
      if (!prompt) return alert('Пожалуйста, введите описание');
      const debug = document.getElementById('debug');
      debug.innerHTML = 'Отправка запроса...\n';

      try {
        const res = await apiFetch('/v1/images/generations', {
          method: 'POST',
          body: JSON.stringify({
            model: "grok-imagine-image",
            prompt: prompt,
            n: 4,
            response_format: "url",
            seed: Math.floor(Math.random() * 2147483647)
          })
        });

        debug.innerHTML += `Статус: ${res.status}\n\n`;
        const data = await res.json();
        debug.innerHTML += 'ПОЛНЫЙ ОТВЕТ ОТ GROK:\n' + JSON.stringify(data, null, 2) + '\n\n';

        if (data.data && data.data.length > 0) {
          displayImages(data.data);
          debug.innerHTML += '✅ Изображения получены и отображены ниже';
        } else {
          debug.innerHTML += '❌ В ответе нет изображений (data.data пустое)';
        }
      } catch (e) {
        debug.innerHTML += '❌ Ошибка запроса: ' + e.message;
      }
    }

    async function editImage() {
      const mainFile = document.getElementById('main-edit-upload').files[0];
      if (!mainFile) return alert('Пожалуйста, загрузите основное фото');
      const prompt = document.getElementById('edit-prompt').value || "Сделать более реалистичным, улучшить качество";
      const debug = document.getElementById('debug');
      debug.innerHTML = 'Отправка запроса на редактирование...\n';

      try {
        const base64Main = await fileToBase64(mainFile);
        const res = await apiFetch('/v1/images/edits', {
          method: 'POST',
          body: JSON.stringify({
            model: "grok-imagine-image",
            prompt: prompt,
            image: { url: base64Main },
            seed: Math.floor(Math.random() * 2147483647)
          })
        });

        debug.innerHTML += `Статус: ${res.status}\n\n`;
        const data = await res.json();
        debug.innerHTML += 'ПОЛНЫЙ ОТВЕТ ОТ GROK:\n' + JSON.stringify(data, null, 2) + '\n\n';

        if (data.data && data.data.length > 0) {
          displayImages(data.data);
          debug.innerHTML += '✅ Изображения получены';
        } else {
          debug.innerHTML += '❌ В ответе нет изображений';
        }
      } catch (e) {
        debug.innerHTML += '❌ Ошибка: ' + e.message;
      }
    }

    // Старт
    switchTab(0);
  </script>
</body>
</html>
